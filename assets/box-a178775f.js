import{S as f,T as u,a as l,U as x,C as g,G as p,c as d,b as T,d as F}from"./index-61cc53d4.js";class c extends f{constructor(t,e=!0){super(t[0]instanceof u?t[0]:t[0].texture),this._textures=null,this._durations=null,this._autoUpdate=e,this._isConnectedToTicker=!1,this.animationSpeed=1,this.loop=!0,this.updateAnchor=!1,this.onComplete=null,this.onFrameChange=null,this.onLoop=null,this._currentTime=0,this._playing=!1,this._previousFrame=null,this.textures=t}stop(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(l.shared.remove(this.update,this),this._isConnectedToTicker=!1))}play(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(l.shared.add(this.update,this,x.HIGH),this._isConnectedToTicker=!0))}gotoAndStop(t){this.stop(),this.currentFrame=t}gotoAndPlay(t){this.currentFrame=t,this.play()}update(t){if(!this._playing)return;const e=this.animationSpeed*t,i=this.currentFrame;if(this._durations!==null){let s=this._currentTime%1*this._durations[this.currentFrame];for(s+=e/60*1e3;s<0;)this._currentTime--,s+=this._durations[this.currentFrame];const r=Math.sign(this.animationSpeed*t);for(this._currentTime=Math.floor(this._currentTime);s>=this._durations[this.currentFrame];)s-=this._durations[this.currentFrame]*r,this._currentTime+=r;this._currentTime+=s/this._durations[this.currentFrame]}else this._currentTime+=e;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):i!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<i||this.animationSpeed<0&&this.currentFrame>i)&&this.onLoop(),this.updateTexture())}updateTexture(){const t=this.currentFrame;this._previousFrame!==t&&(this._previousFrame=t,this._texture=this._textures[t],this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this.uvs=this._texture._uvs.uvsFloat32,this.updateAnchor&&this._anchor.copyFrom(this._texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame))}destroy(t){this.stop(),super.destroy(t),this.onComplete=null,this.onFrameChange=null,this.onLoop=null}static fromFrames(t){const e=[];for(let i=0;i<t.length;++i)e.push(u.from(t[i]));return new c(e)}static fromImages(t){const e=[];for(let i=0;i<t.length;++i)e.push(u.from(t[i]));return new c(e)}get totalFrames(){return this._textures.length}get textures(){return this._textures}set textures(t){if(t[0]instanceof u)this._textures=t,this._durations=null;else{this._textures=[],this._durations=[];for(let e=0;e<t.length;e++)this._textures.push(t[e].texture),this._durations.push(t[e].time)}this._previousFrame=null,this.gotoAndStop(0),this.updateTexture()}get currentFrame(){let t=Math.floor(this._currentTime)%this._textures.length;return t<0&&(t+=this._textures.length),t}set currentFrame(t){if(t<0||t>this.totalFrames-1)throw new Error(`[AnimatedSprite]: Invalid frame index value ${t}, expected to be between 0 and totalFrames ${this.totalFrames}.`);const e=this.currentFrame;this._currentTime=t,e!==this.currentFrame&&this.updateTexture()}get playing(){return this._playing}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(l.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(l.shared.add(this.update,this),this._isConnectedToTicker=!0))}}class C extends g{constructor(t){super(),t=this.normalize(t),this.o=t;const{h:e,w:i,showShape:s,x:r,y:o,speed:m,clr:n,loc:a}=t;let h=new p;h.beginFill(n),h.drawRect(-i/2,-e/2,i,e),h.endFill(),s&&this.addChild(h),this.box=h,this.x=r,this.y=o,this.speed=m,this.loc=a,this.ix=r,this.iy=o,this.setXYmm(t),t.dev&&this.addLogger(),this.uid=(t==null?void 0:t.uid)||Date.now().toString(36),this.kill=(t==null?void 0:t.kill)||(()=>{})}animate(t){let{x:e,y:i}=this;this.o.dev&&this.log(parseInt(e),parseInt(i));let{x:s,y:r}=this.loc,o=(s-e)*(s-e)+(r-i)*(r-i),m=Math.abs(Math.sqrt(o));const n=this.speed*t*.001;if(m<n){this.x=d(s,this.minX,this.maxX),this.y=d(r,this.minY,this.maxY),this.moving=!(parseInt(e)==parseInt(this.x)&&parseInt(i)==parseInt(this.y));return}let a=Math.atan((i-r)/(s-e)).toFixed(2);if(!a)return;let h=(s-e>0?1:-1)*Math.abs(n*Math.cos(a)||0),_=(r-i>0?1:-1)*Math.abs(n*Math.sin(a)||0);h&&_&&(this.x=d(this.x+h,this.minX,this.maxX),this.y=d(this.y+_,this.minY,this.maxY),this.moving=!(parseInt(e)==parseInt(this.x)&&parseInt(i)==parseInt(this.y)))}setXYmm(t){t||(t=this.o),this.maxX=(t==null?void 0:t.maxX)||app.view.width-this.w,this.minX=(t==null?void 0:t.minX)||this.w,this.maxY=(t==null?void 0:t.maxY)||app.view.height-this.h,this.minY=(t==null?void 0:t.minY)||this.h}normalize(t){return t.h||(t.h=60),t.w||(t.w=40),t.showShape||(t.showShape=0),t.x||(t.x=0),t.y||(t.y=0),t.speed||(t.speed=400),t.clr||(t.clr=65280),t.loc||(t.loc={x:app.view.width/2,y:app.view.height/2}),t.dev||(t.dev=0),t}addLogger(){const t=new T({align:"left",fill:"#000000",fontSize:10,fontFamily:"sans"}),e=new F("Logs",t);e.text="Logs",e.backgroundColor=0,e.position.set(-10,-40),this.log=function(...i){let s=i.join(`
`);e.text=s},this.addChild(e),this.logger=e}}export{c as A,C as B};
